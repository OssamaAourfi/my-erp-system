<div class="min-h-screen bg-gray-100 p-6 print:p-0 print:bg-white">

  <div class="max-w-4xl mx-auto mb-6 flex justify-between items-center print:hidden">
    <button routerLink="/commandes"
      class="bg-white border text-gray-700 hover:bg-gray-50 px-4 py-2 rounded shadow-sm flex items-center">
      <i class="pi pi-arrow-left mr-2"></i> Retour
    </button>
    <button (click)="printInvoice()"
      class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded shadow flex items-center gap-2">
      <i class="pi pi-print"></i> Imprimer
    </button>
  </div>

  <div *ngIf="isLoading" class="text-center mt-10 print:hidden">
    <i class="pi pi-spin pi-spinner text-4xl text-blue-600"></i>
  </div>

  <div *ngIf="commande && !isLoading" id="invoice-content"
    class="max-w-4xl mx-auto bg-white p-10 shadow-lg rounded-xl print:shadow-none print:max-w-full print:w-full">

    <div class="flex justify-between items-start border-b border-gray-200 pb-8 mb-8">
      <div>
        <h1 class="text-3xl font-bold text-blue-900 tracking-tight">MY ERP</h1>
        <p class="text-gray-500 mt-2 text-sm">
          123, Avenue des FAR<br>
          Rabat, Maroc<br>
          contact@myerp.com
        </p>
      </div>
      <div class="text-right">
        <h2 class="text-2xl font-bold text-gray-800 uppercase tracking-wide">
          {{ commande.type === 'vente' ? 'FACTURE' : 'BON DE COMMANDE' }}
        </h2>
        <p class="text-gray-600 mt-1">#{{ commande.reference }}</p>
        <p class="text-sm text-gray-500 mt-1">{{ commande.date | date:'dd/MM/yyyy HH:mm' }}</p>
      </div>
    </div>

    <div class="flex justify-between mb-12">
      <div class="w-1/2">
        <h3 class="text-gray-500 font-bold uppercase text-xs tracking-wider mb-2">
          {{ commande.type === 'vente' ? 'Facturé à (Client)' : 'Fournisseur' }}:
        </h3>

        <div *ngIf="partenaireInfo; else noPartenaire">
          <div class="text-gray-900 font-bold text-lg">
            {{ partenaireInfo.nom_societe || partenaireInfo.nom || 'Client Passager' }}
          </div>
          <div class="text-gray-600 text-sm mt-1">{{ partenaireInfo.adresse || 'Adresse non renseignée' }}</div>
          <div class="text-gray-600 text-sm mt-1">
            <i class="pi pi-phone text-xs mr-1"></i> {{ partenaireInfo.telephone }}
          </div>
        </div>

        <ng-template #noPartenaire>
          <p class="text-gray-400 italic">Information partenaire non disponible</p>
        </ng-template>
      </div>
    </div>

    <table class="w-full mb-8 border-collapse">
      <thead>
        <tr class="bg-gray-50 border-y border-gray-200">
          <th class="py-3 px-4 text-left font-semibold text-gray-600 text-sm uppercase">Produit</th>
          <th class="py-3 px-4 text-center font-semibold text-gray-600 text-sm uppercase">Qté</th>
          <th class="py-3 px-4 text-right font-semibold text-gray-600 text-sm uppercase">Prix Unitaire</th>
          <th class="py-3 px-4 text-right font-semibold text-gray-600 text-sm uppercase">Total</th>
        </tr>
      </thead>
      <tbody class="text-gray-700">
        <tr *ngFor="let item of commande.ligneCommandes" class="border-b border-gray-100 hover:bg-gray-50">
          <td class="py-3 px-4">
            <div class="font-medium text-gray-900">{{ item.produit?.designation || 'Article' }}</div>
            <div class="text-xs text-gray-500">{{ item.produit?.reference }}</div>
          </td>
          <td class="py-3 px-4 text-center">{{ item.quantite }}</td>
          <td class="py-3 px-4 text-right">{{ item.prix_unitaire | number:'1.2-2' }} DH</td>
          <td class="py-3 px-4 text-right font-medium text-gray-900">
            {{ (item.quantite * item.prix_unitaire) | number:'1.2-2' }} DH
          </td>
        </tr>

        <tr *ngIf="!commande.ligneCommandes || commande.ligneCommandes.length === 0">
          <td colspan="4" class="py-6 text-center text-gray-400 italic">
            Aucun produit listé dans cette commande.
          </td>
        </tr>
      </tbody>
    </table>

    <div class="flex justify-end mt-6">
      <div class="w-full sm:w-1/2 lg:w-1/3 bg-gray-50 p-4 rounded print:bg-transparent print:p-0">
        <div class="flex justify-between py-2 text-gray-600 text-sm">
          <span>Sous-total:</span>
          <span>{{ commande.total | number:'1.2-2' }} DH</span>
        </div>
        <div class="flex justify-between py-2 text-gray-600 text-sm border-b border-gray-200 mb-2">
          <span>TVA (0%):</span>
          <span>0.00 DH</span>
        </div>
        <div class="flex justify-between items-center pt-2">
          <span class="font-bold text-gray-800 text-lg">Total À Payer:</span>
          <span class="font-bold text-blue-900 text-2xl">{{ commande.total | number:'1.2-2' }} DH</span>
        </div>
      </div>
    </div>

    <div class="mt-16 pt-8 border-t border-gray-200 text-center text-gray-500 text-xs">
      <p>Merci pour votre confiance !</p>
      <p class="mt-1">MY ERP - Patente: 12345678 - RC: 98765 - IF: 11223344</p>
    </div>

  </div>
</div>
