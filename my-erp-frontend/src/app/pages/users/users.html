<div class="bg-white rounded-xl shadow-sm p-6">

  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800">Users List</h2>
    <button (click)="openNew()"
      class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition flex items-center gap-2">
      <i class="pi pi-plus"></i>
      New User
    </button>
  </div>

  <p-table [value]="userList" [tableStyle]="{ 'min-width': '50rem' }" styleClass="p-datatable-striped">
    <ng-template pTemplate="header">
      <tr>
        <th class="p-3 bg-gray-50">ID</th>
        <th class="p-3 bg-gray-50">Email</th>
        <th class="p-3 bg-gray-50">Nom</th>
        <th class="p-3 bg-gray-50">Prénom</th>
        <th class="p-3 bg-gray-50">Roles</th>
        <th class="p-3 bg-gray-50 text-right">Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-user>
      <tr class="border-b hover:bg-gray-50">
        <td class="p-3">{{ user.id }}</td>
        <td class="p-3 font-medium">{{ user.email }}</td>
        <td class="p-3 font-medium">{{ user.nom }}</td>
        <td class="p-3 font-medium">{{ user.prenom }}</td>
        <td class="p-3">
          <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">
            {{ user.roles ? user.roles[0] : 'USER' }}
          </span>
        </td>
        <td class="p-3 text-right">
          <button (click)="onEdit(user)" class="text-blue-500 hover:text-blue-700 mx-2 transition-colors">
            <i class="pi pi-pencil"></i>
          </button>

          <button (click)="onDelete(user.id)" class="text-red-500 hover:text-red-700 transition-colors">
            <i class="pi pi-trash"></i>
          </button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="4" class="text-center p-4 text-gray-500">No users found.</td>
      </tr>
    </ng-template>
  </p-table>

</div>

<p-dialog [header]="userObj.id == 0 ? 'New User Details' : 'Update User'" [(visible)]="visible" [modal]="true"
  [style]="{ width: '30vw' }">

  <div class="flex flex-col gap-4 pt-4">

    <div class="flex flex-col gap-2">
      <label class="font-semibold text-gray-600">Last Name (Nom)</label>
      <input pInputText [(ngModel)]="userObj.nom"
        class="p-2 border rounded border-gray-300 focus:border-blue-500 outline-none" placeholder="Enter Last Name" />
    </div>

    <div class="flex flex-col gap-2">
      <label class="font-semibold text-gray-600">First Name (Prénom)</label>
      <input pInputText [(ngModel)]="userObj.prenom"
        class="p-2 border rounded border-gray-300 focus:border-blue-500 outline-none" placeholder="Enter First Name" />
    </div>

    <div class="flex flex-col gap-2">
      <label class="font-semibold text-gray-600">Email</label>
      <input pInputText [(ngModel)]="userObj.email"
        class="p-2 border rounded border-gray-300 focus:border-blue-500 outline-none" placeholder="example@gmail.com" />
    </div>
    <div class="row mt-3">
      <div class="col-12">
        <label class="fw-bold mb-2">Rôle / Accès</label>
        <p-dropdown [options]="rolesList" [(ngModel)]="selectedRole" optionLabel="label" optionValue="value"
          [style]="{'width':'100%'}" name="roleDropdown">
        </p-dropdown>
      </div>
    </div>
    <div class="flex flex-col gap-2">
      <label class="font-semibold text-gray-600">Password</label>
      <input type="password" pInputText [(ngModel)]="userObj.password"
        class="p-2 border rounded border-gray-300 focus:border-blue-500 outline-none" placeholder="********" />
    </div>

  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2 mt-4">
      <button (click)="visible = false" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancel</button>
      <button (click)="saveUser()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
    </div>
  </ng-template>

</p-dialog>
